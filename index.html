<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Le guide ultime pour voyager à Madagascar - Spots locaux authentiques, carte interactive offline, expressions malgaches">
    <meta name="theme-color" content="#C13535">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>MG Guide Voyage Madagascar - Le guide que seuls les Malgaches connaissent</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="shortcut icon" href="icons/favicon.ico">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Inter:wght@300;400;500;600&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    
    <style>
        /* ============================================
           VARIABLES CSS & RESET
           ============================================ */
        :root {
            /* Couleurs principales (identité malgache) */
            --laterite: #C13535;
            --foret: #3A5F3A;
            --sable: #D8B48F;
            --creme: #F9F5F0;
            --noir: #12100E;
            
            /* Statuts */
            --gratuit: #16A34A;
            --abordable: #F59E0B;
            --premium: #DC2626;
            
            /* UI */
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.15);
            --radius: 12px;
            --radius-sm: 8px;
            
            /* Typographie */
            --font-display: 'Quicksand', sans-serif;
            --font-body: 'Inter', sans-serif;
            --font-mono: 'Roboto Mono', monospace;
            
            /* Mode clair (défaut) */
            --bg-primary: var(--creme);
            --bg-secondary: #FFFFFF;
            --text-primary: var(--noir);
            --text-secondary: #6B7280;
            --border-color: #E5E7EB;
        }
        
        [data-theme="dark"] {
            --bg-primary: #1A1A1A;
            --bg-secondary: #2D2D2D;
            --text-primary: #F9F5F0;
            --text-secondary: #9CA3AF;
            --border-color: #404040;
            --shadow: 0 2px 8px rgba(0,0,0,0.3);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.4);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: var(--font-body);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* ============================================
           HEADER PREMIUM (NON SCROLLABLE)
           ============================================ */
        .header-premium {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: linear-gradient(135deg, var(--laterite) 0%, var(--foret) 100%);
            color: white;
            padding: 16px 20px;
            box-shadow: var(--shadow-lg);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
        }
        
        .header-left {
            flex: 1;
        }
        
        .header-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .badge-premium {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: var(--noir);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .header-tagline {
            font-size: 0.875rem;
            opacity: 0.95;
            font-style: italic;
        }
        
        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 24px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }
        
        .theme-toggle:active {
            transform: scale(0.95);
        }
        
        /* ============================================
           NAVIGATION SCROLLABLE
           ============================================ */
        .nav-container {
            position: sticky;
            top: 80px;
            z-index: 999;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        
        .nav-container::-webkit-scrollbar {
            display: none;
        }
        
        .main-nav {
            display: flex;
            gap: 8px;
            padding: 12px 20px;
            min-width: max-content;
        }
        
        .nav-btn {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 24px;
            padding: 10px 20px;
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .nav-btn:hover {
            background: var(--laterite);
            border-color: var(--laterite);
            color: white;
            transform: translateY(-2px);
        }
        
        .nav-btn.active {
            background: var(--laterite);
            border-color: var(--laterite);
            color: white;
            font-weight: 600;
        }
        
        /* ============================================
           MAIN CONTENT
           ============================================ */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .page-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .page-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ============================================
           CARTE INTERACTIVE
           ============================================ */
        #map {
            height: 500px;
            width: 100%;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            margin-bottom: 20px;
        }
        
        .map-filters {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        
        .filter-group {
            margin-bottom: 16px;
        }
        
        .filter-group:last-child {
            margin-bottom: 0;
        }
        
        .filter-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
            font-size: 0.95rem;
        }
        
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .filter-checkbox {
            display: none;
        }
        
        .filter-label {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .filter-checkbox:checked + .filter-label {
            background: var(--laterite);
            border-color: var(--laterite);
            color: white;
            font-weight: 500;
        }
        
        .filter-label:hover {
            border-color: var(--laterite);
        }
        
        /* ============================================
           SHORTCUTS RAPIDES
           ============================================ */
        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        
        .shortcut-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .shortcut-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--laterite);
        }
        
        .shortcut-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }
        
        .shortcut-title {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .shortcut-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* ============================================
           CARDS LIEUX
           ============================================ */
        .lieux-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .lieu-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .lieu-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--laterite);
        }
        
        .lieu-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--sable);
        }
        
        .lieu-content {
            padding: 16px;
        }
        
        .lieu-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .lieu-title {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }
        
        .badge-spot {
            background: var(--laterite);
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .badge-type {
            background: var(--foret);
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .lieu-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .lieu-prix {
            font-family: var(--font-mono);
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .lieu-prix.gratuit {
            color: var(--gratuit);
        }
        
        .lieu-prix.abordable {
            color: var(--abordable);
        }
        
        .lieu-prix.premium {
            color: var(--premium);
        }
        
        .lieu-note {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .lieu-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 16px;
        }
        
        .btn-details {
            width: 100%;
            background: var(--laterite);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 12px;
            font-family: var(--font-body);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-details:hover {
            background: #A12929;
            transform: scale(1.02);
        }
        
        .btn-details:active {
            transform: scale(0.98);
        }
        
        /* ============================================
           MODAL DÉTAILS
           ============================================ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            overflow-y: auto;
            animation: fadeIn 0.2s ease;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background: rgba(0,0,0,0.7);
            transform: scale(1.1);
        }
        
        .modal-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal-title {
            font-family: var(--font-display);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        
        .modal-section {
            margin-bottom: 20px;
        }
        
        .modal-section-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--laterite);
        }
        
        .modal-section-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .modal-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .modal-info-item {
            background: var(--bg-primary);
            padding: 12px;
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--laterite);
        }
        
        .modal-info-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .modal-info-value {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* ============================================
           LANGUE - ACCORDÉONS
           ============================================ */
        .langue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 2px solid var(--border-color);
            border-radius: 24px;
            font-family: var(--font-body);
            font-size: 0.95rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--laterite);
            box-shadow: 0 0 0 3px rgba(193,53,53,0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            color: var(--text-secondary);
        }
        
        .accordion-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .accordion-item {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 2px solid transparent;
            transition: border-color 0.2s ease;
        }
        
        .accordion-item.open {
            border-color: var(--laterite);
        }
        
        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            cursor: pointer;
            user-select: none;
            background: var(--bg-secondary);
            transition: background 0.2s ease;
        }
        
        .accordion-header:hover {
            background: var(--bg-primary);
        }
        
        .accordion-title {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .accordion-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }
        
        .accordion-item.open .accordion-icon {
            transform: rotate(180deg);
        }
        
        .accordion-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .accordion-item.open .accordion-body {
            max-height: 2000px;
        }
        
        .accordion-content {
            padding: 0 20px 20px 20px;
        }
        
        .phrase-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }
        
        .phrase-item:hover {
            background: var(--bg-secondary);
            transform: translateX(4px);
        }
        
        .phrase-content {
            flex: 1;
        }
        
        .phrase-fr {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .phrase-mg {
            color: var(--laterite);
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .phrase-phonetic {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-style: italic;
        }
        
        .phrase-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-icon {
            background: var(--laterite);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s ease;
        }
        
        .btn-icon:hover {
            background: #A12929;
            transform: scale(1.1);
        }
        
        .btn-icon:active {
            transform: scale(0.9);
        }
        
        .btn-icon.favorite.active {
            background: #FFD700;
            color: var(--noir);
        }
        
        /* ============================================
           OUTILS
           ============================================ */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .tool-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
        }
        
        .tool-title {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .converter-inputs {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .converter-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .converter-input {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-family: var(--font-mono);
            font-size: 1.1rem;
            font-weight: 500;
            background: var(--bg-primary);
            color: var(--text-primary);
            text-align: center;
        }
        
        .converter-input:focus {
            outline: none;
            border-color: var(--laterite);
        }
        
        .converter-label {
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 50px;
        }
        
        .rate-info {
            text-align: center;
            padding: 12px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 8px;
        }
        
        .btn-modify {
            margin-top: 12px;
            background: var(--foret);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 10px 16px;
            font-family: var(--font-body);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-modify:hover {
            background: #2D4A2D;
        }
        
        .checklist-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .checklist-item:hover {
            background: var(--bg-secondary);
            transform: translateX(4px);
        }
        
        .checklist-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .checklist-item.checked .checklist-checkbox {
            background: var(--gratuit);
            border-color: var(--gratuit);
        }
        
        .checklist-checkbox::after {
            content: '✓';
            color: white;
            font-weight: bold;
            display: none;
        }
        
        .checklist-item.checked .checklist-checkbox::after {
            display: block;
        }
        
        .checklist-label {
            flex: 1;
            color: var(--text-primary);
        }
        
        .checklist-item.checked .checklist-label {
            text-decoration: line-through;
            opacity: 0.6;
        }
        
        .seasonal-advice {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .advice-item {
            padding: 16px;
            border-radius: var(--radius-sm);
            border-left: 4px solid;
        }
        
        .advice-item.good {
            background: rgba(22,163,74,0.1);
            border-color: var(--gratuit);
        }
        
        .advice-item.warning {
            background: rgba(245,158,11,0.1);
            border-color: var(--abordable);
        }
        
        .advice-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .advice-list {
            color: var(--text-secondary);
            font-size: 0.9rem;
            list-style-position: inside;
        }
        
        .contacts-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .contact-group-title {
            font-weight: 600;
            color: var(--laterite);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .contact-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
        }
        
        .contact-name {
            color: var(--text-primary);
        }
        
        .contact-number {
            font-family: var(--font-mono);
            color: var(--laterite);
            font-weight: 500;
        }
        
        /* ============================================
           RESPONSIVE
           ============================================ */
        @media (max-width: 768px) {
            .header-title {
                font-size: 1.2rem;
            }
            
            .header-tagline {
                font-size: 0.8rem;
            }
            
            .theme-toggle {
                width: 44px;
                height: 44px;
            }
            
            .nav-container {
                top: 72px;
            }
            
            .main-nav {
                padding: 10px 16px;
                gap: 6px;
            }
            
            .nav-btn {
                padding: 8px 16px;
                font-size: 0.85rem;
            }
            
            .main-content {
                padding: 16px;
            }
            
            #map {
                height: 400px;
            }
            
            .shortcuts-grid {
                grid-template-columns: 1fr;
            }
            
            .lieux-grid {
                grid-template-columns: 1fr;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 10px;
            }
            
            .modal-title {
                font-size: 1.5rem;
            }
        }
        
        @media (min-width: 1024px) {
            #map {
                height: 600px;
            }
        }
        
        /* ============================================
           UTILITAIRES
           ============================================ */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        .mb-20 {
            margin-bottom: 20px;
        }
        
        /* Leaflet popup customization */
        .leaflet-popup-content-wrapper {
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
        }
        
        .leaflet-popup-content {
            margin: 12px;
            font-family: var(--font-body);
        }
        
        .popup-content {
            min-width: 200px;
        }
        
        .popup-title {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 6px;
            color: var(--noir);
        }
        
        .popup-price {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
        
        .popup-rating {
            font-size: 0.85rem;
            color: #666;
        }
        
        /* Installation prompt */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--laterite);
            color: white;
            padding: 16px 24px;
            border-radius: 50px;
            box-shadow: var(--shadow-lg);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 9999;
            animation: slideUp 0.3s ease;
        }
        
        .install-prompt.active {
            display: flex;
        }
        
        .install-btn {
            background: white;
            color: var(--laterite);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .install-btn:hover {
            transform: scale(1.05);
        }
        
        .install-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <!-- Header Premium -->
    <header class="header-premium">
        <div class="header-content">
            <div class="header-left">
                <h1 class="header-title">
                    🌍 MG Guide Voyage Madagascar
                    <span class="badge-premium">PREMIUM</span>
                </h1>
                <p class="header-tagline">Le guide que seuls les Malgaches connaissent</p>
            </div>
            <button class="theme-toggle" id="themeToggle" aria-label="Changer de thème">
                ☀️
            </button>
        </div>
    </header>
    
    <!-- Navigation -->
    <nav class="nav-container">
        <div class="main-nav" id="mainNav">
            <button class="nav-btn active" data-page="carte">🗺️ Carte</button>
            <button class="nav-btn" data-page="antananarivo">🏛️ Antananarivo</button>
            <button class="nav-btn" data-page="diego">🏝️ Diego-Suarez</button>
            <button class="nav-btn" data-page="nosybe">🌴 Nosy Be</button>
            <button class="nav-btn" data-page="mahajanga">🌊 Mahajanga</button>
            <button class="nav-btn" data-page="andasibe">🌿 Andasibe</button>
            <button class="nav-btn" data-page="isalo">🏜️ Isalo</button>
            <button class="nav-btn" data-page="ifaty">🏖️ Ifaty</button>
            <button class="nav-btn" data-page="ankarana">🕳️ Ankarana</button>
            <button class="nav-btn" data-page="mananara">🐊 Mananara</button>
            <button class="nav-btn" data-page="spots">🔥 Spots Locaux</button>
            <button class="nav-btn" data-page="langue">🗣️ Langue</button>
            <button class="nav-btn" data-page="outils">🧰 Outils</button>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Carte -->
        <section id="page-carte" class="page-section active">
            <!-- Filtres -->
            <div class="map-filters">
                <div class="filter-group">
                    <div class="filter-title">📍 Villes</div>
                    <div class="filter-options">
                        <input type="checkbox" id="filter-antananarivo" class="filter-checkbox" checked>
                        <label for="filter-antananarivo" class="filter-label">Antananarivo</label>
                        
                        <input type="checkbox" id="filter-diego" class="filter-checkbox" checked>
                        <label for="filter-diego" class="filter-label">Diego-Suarez</label>
                        
                        <input type="checkbox" id="filter-nosybe" class="filter-checkbox" checked>
                        <label for="filter-nosybe" class="filter-label">Nosy Be</label>
                        
                        <input type="checkbox" id="filter-mahajanga" class="filter-checkbox" checked>
                        <label for="filter-mahajanga" class="filter-label">Mahajanga</label>
                        
                        <input type="checkbox" id="filter-andasibe" class="filter-checkbox" checked>
                        <label for="filter-andasibe" class="filter-label">Andasibe</label>
                        
                        <input type="checkbox" id="filter-isalo" class="filter-checkbox" checked>
                        <label for="filter-isalo" class="filter-label">Isalo</label>
                        
                        <input type="checkbox" id="filter-ifaty" class="filter-checkbox" checked>
                        <label for="filter-ifaty" class="filter-label">Ifaty</label>
                        
                        <input type="checkbox" id="filter-ankarana" class="filter-checkbox" checked>
                        <label for="filter-ankarana" class="filter-label">Ankarana</label>
                        
                        <input type="checkbox" id="filter-mananara" class="filter-checkbox" checked>
                        <label for="filter-mananara" class="filter-label">Mananara</label>
                    </div>
                </div>
                
                <div class="filter-group">
                    <div class="filter-title">🏷️ Types</div>
                    <div class="filter-options">
                        <input type="checkbox" id="filter-incontournable" class="filter-checkbox" checked>
                        <label for="filter-incontournable" class="filter-label">Incontournable</label>
                        
                        <input type="checkbox" id="filter-spotlocal" class="filter-checkbox" checked>
                        <label for="filter-spotlocal" class="filter-label">Spot Local</label>
                        
                        <input type="checkbox" id="filter-nature" class="filter-checkbox" checked>
                        <label for="filter-nature" class="filter-label">Nature</label>
                        
                        <input type="checkbox" id="filter-restaurant" class="filter-checkbox" checked>
                        <label for="filter-restaurant" class="filter-label">Restaurant</label>
                        
                        <input type="checkbox" id="filter-culture" class="filter-checkbox" checked>
                        <label for="filter-culture" class="filter-label">Culture</label>
                    </div>
                </div>
                
                <div class="filter-group">
                    <div class="filter-title">💰 Prix</div>
                    <div class="filter-options">
                        <input type="checkbox" id="filter-gratuit" class="filter-checkbox" checked>
                        <label for="filter-gratuit" class="filter-label">Gratuit</label>
                        
                        <input type="checkbox" id="filter-economique" class="filter-checkbox" checked>
                        <label for="filter-economique" class="filter-label">&lt; 10 000 Ar</label>
                        
                        <input type="checkbox" id="filter-moyen" class="filter-checkbox" checked>
                        <label for="filter-moyen" class="filter-label">≥ 10 000 Ar</label>
                    </div>
                </div>
            </div>
            
            <!-- Carte -->
            <div id="map"></div>
            
            <!-- Shortcuts -->
            <div class="shortcuts-grid">
                <div class="shortcut-card" data-goto="spots">
                    <div class="shortcut-icon">🔥</div>
                    <h3 class="shortcut-title">Spots Locaux</h3>
                    <p class="shortcut-desc">9 lieux secrets accessibles uniquement via contact local</p>
                </div>
                
                <div class="shortcut-card" data-goto="langue">
                    <div class="shortcut-icon">🗣️</div>
                    <h3 class="shortcut-title">50+ Expressions</h3>
                    <p class="shortcut-desc">Phrases essentielles en malgache avec prononciation audio</p>
                </div>
                
                <div class="shortcut-card" data-goto="outils">
                    <div class="shortcut-icon">🧰</div>
                    <h3 class="shortcut-title">Outils Terrain</h3>
                    <p class="shortcut-desc">Convertisseur devises, checklist voyage, numéros utiles</p>
                </div>
            </div>
        </section>
        
        <!-- Pages Villes (template dynamique) -->
        <section id="page-antananarivo" class="page-section"></section>
        <section id="page-diego" class="page-section"></section>
        <section id="page-nosybe" class="page-section"></section>
        <section id="page-mahajanga" class="page-section"></section>
        <section id="page-andasibe" class="page-section"></section>
        <section id="page-isalo" class="page-section"></section>
        <section id="page-ifaty" class="page-section"></section>
        <section id="page-ankarana" class="page-section"></section>
        <section id="page-mananara" class="page-section"></section>
        
        <!-- Page Spots Locaux -->
        <section id="page-spots" class="page-section">
            <h2 class="page-title" style="font-family: var(--font-display); font-size: 2rem; margin-bottom: 20px; color: var(--laterite);">🔥 Spots Locaux Authentiques</h2>
            <p style="color: var(--text-secondary); margin-bottom: 30px; font-size: 1.1rem;">
                Ces lieux sont <strong>inaccessibles sans contact humain local</strong>. Non référencés sur Google Maps, absents des guides touristiques traditionnels.
            </p>
            <div id="spotsContainer" class="lieux-grid"></div>
        </section>
        
        <!-- Page Langue -->
        <section id="page-langue" class="page-section">
            <div class="langue-header">
                <h2 style="font-family: var(--font-display); font-size: 2rem; color: var(--text-primary);">🗣️ Expressions Malgaches</h2>
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <input type="text" id="langueSearch" class="search-input" placeholder="Rechercher une expression...">
                </div>
            </div>
            
            <div id="accordionContainer" class="accordion-container"></div>
        </section>
        
        <!-- Page Outils -->
        <section id="page-outils" class="page-section">
            <h2 style="font-family: var(--font-display); font-size: 2rem; margin-bottom: 30px; color: var(--text-primary);">🧰 Outils Terrain</h2>
            
            <div class="tools-grid">
                <!-- Convertisseur -->
                <div class="tool-card">
                    <h3 class="tool-title">💱 Convertisseur Ar ↔ €</h3>
                    <div class="converter-inputs">
                        <div class="converter-row">
                            <span class="converter-label">Ar</span>
                            <input type="number" id="inputAr" class="converter-input" value="42500" min="0">
                        </div>
                        <div style="text-align: center; color: var(--text-secondary); font-size: 1.5rem;">⇅</div>
                        <div class="converter-row">
                            <span class="converter-label">€</span>
                            <input type="number" id="inputEuro" class="converter-input" value="10" min="0" step="0.01">
                        </div>
                    </div>
                    <div class="rate-info">
                        Taux : 1 € = <span id="rateDisplay">4250</span> Ar
                    </div>
                    <button class="btn-modify" id="btnModifyRate">Modifier le taux</button>
                </div>
                
                <!-- Checklist -->
                <div class="tool-card">
                    <h3 class="tool-title">✅ Checklist Voyage</h3>
                    <div class="checklist-items" id="checklistContainer"></div>
                </div>
                
                <!-- Conseils Saisonniers -->
                <div class="tool-card">
                    <h3 class="tool-title">📅 Conseils Saisonniers</h3>
                    <div class="seasonal-advice">
                        <div class="advice-item good">
                            <div class="advice-title">🌞 Meilleure période : MAI à OCTOBRE</div>
                            <ul class="advice-list">
                                <li>Météo stable, routes praticables</li>
                                <li>Observation lémuriens optimale</li>
                                <li>Températures agréables (20-25°C)</li>
                            </ul>
                        </div>
                        <div class="advice-item warning">
                            <div class="advice-title">⚠️ À éviter : JANVIER à MARS</div>
                            <ul class="advice-list">
                                <li>Saison des pluies (cyclones possibles)</li>
                                <li>Routes coupées, parcs fermés</li>
                                <li>Forte humidité</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Numéros Utiles -->
                <div class="tool-card">
                    <h3 class="tool-title">📞 Numéros Utiles</h3>
                    <div class="contacts-list">
                        <div>
                            <div class="contact-group-title">🚨 Urgences</div>
                            <div class="contact-item">
                                <span class="contact-name">Police</span>
                                <span class="contact-number">117</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-name">Pompiers</span>
                                <span class="contact-number">118</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-name">Ambulance</span>
                                <span class="contact-number">119</span>
                            </div>
                        </div>
                        
                        <div>
                            <div class="contact-group-title">🏛️ Ambassades</div>
                            <div class="contact-item">
                                <span class="contact-name">France</span>
                                <span class="contact-number">+261 20 22 399 98</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-name">Belgique</span>
                                <span class="contact-number">+261 20 22 241 69</span>
                            </div>
                        </div>
                        
                        <div>
                            <div class="contact-group-title">📶 Opérateurs</div>
                            <div class="contact-item">
                                <span class="contact-name">Telma</span>
                                <span class="contact-number">*111#</span>
                            </div>
                            <div class="contact-item">
                                <span class="contact-name">Airtel</span>
                                <span class="contact-number">*121#</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Modal Détails -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">×</button>
            <img id="modalImage" class="modal-image" src="" alt="">
            <div class="modal-body">
                <h2 id="modalTitle" class="modal-title"></h2>
                <div id="modalBadges" style="margin-bottom: 16px;"></div>
                <div id="modalInfoGrid" class="modal-info-grid"></div>
                <div id="modalSections"></div>
            </div>
        </div>
    </div>
    
    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt">
        <span>📱 Installer l'app pour un accès offline</span>
        <button class="install-btn" id="installBtn">Installer</button>
        <button class="install-close" id="installClose">×</button>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    
    <script>
        // ============================================
        // DONNÉES
        // ============================================
        
        const LIEUX_DATA = [
            // ANTANANARIVO
            {
                id: 1,
                ville: "Antananarivo",
                nom: "Palais de la Reine (Rova)",
                type: "Incontournable",
                lat: -18.9151,
                lng: 47.5283,
                prix: "10 000 Ar",
                prixEur: "2 €",
                prixNum: 10000,
                note: 4.5,
                description: "Palais royal perché sur la colline, symbole de la monarchie merina. Vue panoramique sur Tana.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EPalais Royal%3C/text%3E%3C/svg%3E",
                acces: "Centre-ville d'Antananarivo, colline d'Ambohimanga",
                horaires: "9h-17h tous les jours",
                respect: "Tenue correcte exigée, pas de short"
            },
            {
                id: 2,
                ville: "Antananarivo",
                nom: "Marché Artisanal de La Digue",
                type: "Culture",
                lat: -18.9087,
                lng: 47.5236,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.3,
                description: "Marché d'artisanat local avec sculptures, textiles, vannerie. Idéal pour souvenirs authentiques.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%233A5F3A' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EMarché Artisanal%3C/text%3E%3C/svg%3E",
                acces: "Avenue de l'Indépendance",
                horaires: "8h-18h du lundi au samedi"
            },
            {
                id: 3,
                ville: "Antananarivo",
                nom: "Parc de Tsarasaotra",
                type: "Nature",
                lat: -18.9352,
                lng: 47.5467,
                prix: "5 000 Ar",
                prixEur: "1 €",
                prixNum: 5000,
                note: 4.6,
                description: "Réserve ornithologique urbaine avec hérons, canards, martins-pêcheurs.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%233A5F3A' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EParc Oiseaux%3C/text%3E%3C/svg%3E",
                acces: "Quartier Tsarasaotra",
                horaires: "7h-17h tous les jours"
            },
            {
                id: 4,
                ville: "Antananarivo",
                nom: "Source Sacrée d'Ambohijatovo",
                type: "Spot Local",
                spotLocal: true,
                lat: -18.9204,
                lng: 47.5289,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.9,
                description: "Source sacrée cachée derrière l'église Andohalo. Lieu spirituel vénéré par les habitants.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3ESource Sacrée%3C/text%3E%3C/svg%3E",
                acces: "Pas de GPS - Derrière l'église Andohalo, demander au gardien qui montre le chemin",
                contactLocal: "Le gardien de l'église (présent le matin)",
                respect: "Offrande traditionnelle recommandée, silence requis, ne pas toucher l'eau sans permission"
            },
            {
                id: 5,
                ville: "Antananarivo",
                nom: "Restaurant La Varangue",
                type: "Restaurant",
                lat: -18.9122,
                lng: 47.5341,
                prix: "40 000 Ar",
                prixEur: "9 €",
                prixNum: 40000,
                note: 4.7,
                description: "Cuisine gastronomique malgache dans une villa coloniale. Terrasse avec vue.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23D8B48F' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='%2312100E' text-anchor='middle' dy='.3em'%3ELa Varangue%3C/text%3E%3C/svg%3E",
                acces: "Rue Printsy Ratsimamanga, Isoraka",
                horaires: "12h-14h30 et 19h-22h"
            },
            
            // DIEGO-SUAREZ
            {
                id: 6,
                ville: "Diego-Suarez",
                nom: "Plage de Ramena",
                type: "Incontournable",
                lat: -12.2667,
                lng: 49.4167,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.6,
                description: "3 km de sable blanc immaculé, eau turquoise, ambiance village de pêcheurs traditionnel.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2300BFFF' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3ERamena Beach%3C/text%3E%3C/svg%3E",
                acces: "18 km de Diego, taxi-brousse ou taxi",
                horaires: "Accessible 24h/24"
            },
            {
                id: 7,
                ville: "Diego-Suarez",
                nom: "Mer d'Émeraude",
                type: "Incontournable",
                lat: -12.2156,
                lng: 49.3789,
                prix: "40 000 Ar",
                prixEur: "9 €",
                prixNum: 40000,
                note: 4.9,
                description: "Baie spectaculaire aux eaux turquoise cristallines. Snorkeling exceptionnel, bancs de sable, déjeuner langoustes.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2300CED1' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='22' fill='white' text-anchor='middle' dy='.3em'%3EMer d'Ã‰meraude%3C/text%3E%3C/svg%3E",
                acces: "Excursion bateau depuis Ramena (45 min)",
                horaires: "Départ 8h-9h, retour 16h-17h"
            },
            {
                id: 8,
                ville: "Diego-Suarez",
                nom: "Les Trois Baies",
                type: "Nature",
                lat: -12.1945,
                lng: 49.3645,
                prix: "30 000 Ar",
                prixEur: "7 €",
                prixNum: 30000,
                note: 4.7,
                description: "Baie des Sakalava, Baie des Pigeons, Baie des Dunes. Circuit panoramique inoubliable en bateau.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%234682B4' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3ETrois Baies%3C/text%3E%3C/svg%3E",
                acces: "Excursion bateau depuis Diego",
                horaires: "Journée complète recommandée"
            },
            {
                id: 9,
                ville: "Diego-Suarez",
                nom: "Montagne d'Ambre",
                type: "Nature",
                lat: -12.5167,
                lng: 49.1667,
                prix: "45 000 Ar",
                prixEur: "10 €",
                prixNum: 45000,
                note: 4.9,
                description: "Parc national à 1475m d'altitude. Cascades spectaculaires, lémuriens couronnés, forêt tropicale humide, caméléons.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%233A5F3A' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3EMontagne d'Ambre%3C/text%3E%3C/svg%3E",
                acces: "30 km au sud de Diego par RN6, depuis Joffreville",
                horaires: "8h-16h avec guide obligatoire"
            },
            {
                id: 10,
                ville: "Diego-Suarez",
                nom: "Tsingy Rouge",
                type: "Nature",
                lat: -12.3978,
                lng: 49.2456,
                prix: "8 000 Ar",
                prixEur: "2 €",
                prixNum: 8000,
                note: 4.8,
                description: "Formations géologiques rouges spectaculaires, canyons érodés, paysage lunaire unique au monde.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3ETsingy Rouge%3C/text%3E%3C/svg%3E",
                acces: "60 km de Diego, route de Joffreville",
                horaires: "Lever/coucher de soleil recommandé"
            },
            {
                id: 11,
                ville: "Diego-Suarez",
                nom: "Windsor Castle",
                type: "Nature",
                lat: -12.2734,
                lng: 49.2912,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.5,
                description: "Imposant monolithe visible depuis Diego. Trek panoramique avec vue à 360° sur la baie.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23D8B48F' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='22' fill='%2312100E' text-anchor='middle' dy='.3em'%3EWindsor Castle%3C/text%3E%3C/svg%3E",
                acces: "Accessible depuis Diego, sentier de randonnée",
                horaires: "Matinée recommandée (chaleur)"
            },
            {
                id: 12,
                ville: "Diego-Suarez",
                nom: "Montagne des Français",
                type: "Nature",
                lat: -12.3123,
                lng: 49.3256,
                prix: "10 000 Ar",
                prixEur: "2.50 €",
                prixNum: 10000,
                note: 4.6,
                description: "Massif calcaire avec sentiers de randonnée, baobabs, vue panoramique sur la baie de Diego.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%238B4513' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='18' fill='white' text-anchor='middle' dy='.3em'%3EMontagne Français%3C/text%3E%3C/svg%3E",
                acces: "5 km au sud de Diego, accessible en taxi",
                horaires: "6h-18h, guide recommandé"
            },
            {
                id: 13,
                ville: "Diego-Suarez",
                nom: "Restaurant Le Melville",
                type: "Restaurant",
                lat: -12.2756,
                lng: 49.2934,
                prix: "35 000 Ar",
                prixEur: "8 €",
                prixNum: 35000,
                note: 4.7,
                description: "Restaurant face à la mer, spécialités de fruits de mer, poissons grillés, langoustes. Cadre colonial.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23FF6347' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='22' fill='white' text-anchor='middle' dy='.3em'%3ELe Melville%3C/text%3E%3C/svg%3E",
                acces: "Front de mer de Diego, centre-ville",
                horaires: "11h-22h, fermé lundi"
            },
            {
                id: 33,
                ville: "Diego-Suarez",
                nom: "Restaurant La Cambusa",
                type: "Restaurant",
                lat: -12.2745,
                lng: 49.2923,
                prix: "40 000 Ar",
                prixEur: "9 €",
                prixNum: 40000,
                note: 4.8,
                description: "Cuisine italienne et malgache, pizzas au feu de bois, pâtes fraîches, ambiance conviviale.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23228B22' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='22' fill='white' text-anchor='middle' dy='.3em'%3ELa Cambusa%3C/text%3E%3C/svg%3E",
                acces: "Centre-ville de Diego, rue Colbert",
                horaires: "12h-14h et 19h-22h"
            },
            {
                id: 15,
                ville: "Diego-Suarez",
                nom: "Nosy Lonjo (Pain de Sucre)",
                type: "Nature",
                lat: -12.2634,
                lng: 49.3123,
                prix: "25 000 Ar",
                prixEur: "6 €",
                prixNum: 25000,
                note: 4.6,
                description: "Îlot emblématique de la baie, ressemble au Pain de Sucre de Rio. Accessible en bateau, snorkeling.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2387CEEB' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3ENosy Lonjo%3C/text%3E%3C/svg%3E",
                acces: "Excursion bateau depuis Diego (30 min)",
                horaires: "Matinée recommandée"
            },
            {
                id: 16,
                ville: "Diego-Suarez",
                nom: "Grotte des Pêcheurs",
                type: "Spot Local",
                spotLocal: true,
                lat: -12.2389,
                lng: 49.3012,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.8,
                description: "Grotte marine accessible uniquement à marée basse, lieu de prière des pêcheurs locaux Sakalava.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3EGrotte Secrète%3C/text%3E%3C/svg%3E",
                acces: "Plage nord de Ramena à marée basse uniquement - Demander Paul au marché aux poissons qui guide gratuitement",
                contactLocal: "Paul, pêcheur au marché central de Diego (matin 6h-9h)",
                respect: "Retirer chaussures à l'entrée, ne pas toucher aux offrandes, silence"
            },
            
            // NOSY BE
            {
                id: 17,
                ville: "Nosy Be",
                nom: "Plage d'Andilana",
                type: "Incontournable",
                lat: -13.3167,
                lng: 48.2667,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.8,
                description: "La plus belle plage de Nosy Be. Sable blanc immaculé, eau turquoise, palmiers, couchers de soleil spectaculaires.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2300BFFF' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EAndilana%3C/text%3E%3C/svg%3E",
                acces: "Nord de Nosy Be, 25 km de Hell-Ville",
                horaires: "Accessible 24h/24"
            },
            {
                id: 18,
                ville: "Nosy Be",
                nom: "Nosy Komba (Île aux Lémuriens)",
                type: "Incontournable",
                lat: -13.4167,
                lng: 48.3000,
                prix: "40 000 Ar",
                prixEur: "9 €",
                prixNum: 40000,
                note: 4.9,
                description: "Île volcanique avec lémuriens macaco apprivoisés, village de pêcheurs, artisanat local, végétation luxuriante.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%233A5F3A' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='22' fill='white' text-anchor='middle' dy='.3em'%3ENosy Komba%3C/text%3E%3C/svg%3E",
                acces: "Bateau depuis Ambatoloaka (25 min)",
                horaires: "Excursion journée ou demi-journée"
            },
            {
                id: 19,
                ville: "Nosy Be",
                nom: "Nosy Tanikely (Réserve Marine)",
                type: "Nature",
                lat: -13.3778,
                lng: 48.2945,
                prix: "35 000 Ar",
                prixEur: "8 €",
                prixNum: 35000,
                note: 4.9,
                description: "Réserve marine protégée. Snorkeling exceptionnel, tortues, raies, poissons multicolores. Surnommée 'l'aquarium'.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2300CED1' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3ENosy Tanikely%3C/text%3E%3C/svg%3E",
                acces: "Excursion bateau, tous clubs de plongée",
                horaires: "Sortie journée avec déjeuner"
            },
            {
                id: 20,
                ville: "Nosy Be",
                nom: "Nosy Iranja",
                type: "Incontournable",
                lat: -13.3834,
                lng: 48.0123,
                prix: "50 000 Ar",
                prixEur: "12 €",
                prixNum: 50000,
                note: 5.0,
                description: "Deux îles reliées par banc de sable blanc à marée basse. Tortues vertes géantes, lagon turquoise, phare panoramique.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2320B2AA' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='22' fill='white' text-anchor='middle' dy='.3em'%3ENosy Iranja%3C/text%3E%3C/svg%3E",
                acces: "Excursion bateau (1h30), départ Hell-Ville",
                horaires: "Journée complète, départ 7h"
            },
            {
                id: 21,
                ville: "Nosy Be",
                nom: "Réserve de Lokobe",
                type: "Nature",
                lat: -13.4167,
                lng: 48.3500,
                prix: "35 000 Ar",
                prixEur: "8 €",
                prixNum: 35000,
                note: 4.7,
                description: "Dernière forêt primaire de Nosy Be (740 hectares). Lémuriens macaco noirs, boas, caméléons, oiseaux endémiques.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%233A5F3A' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3ELokobe%3C/text%3E%3C/svg%3E",
                acces: "Sud-est de l'île, accessible en bateau + randonnée",
                horaires: "Excursions guidées matin (fraîcheur)"
            },
            {
                id: 22,
                ville: "Nosy Be",
                nom: "Mont Passot",
                type: "Nature",
                lat: -13.3612,
                lng: 48.2678,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.7,
                description: "Point culminant de Nosy Be (329m). Vue panoramique 360°, lacs sacrés avec crocodiles, coucher de soleil magique.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23FF8C00' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EMont Passot%3C/text%3E%3C/svg%3E",
                acces: "Centre de l'île, 15 km de Hell-Ville",
                horaires: "Lever/coucher de soleil recommandés"
            },
            {
                id: 23,
                ville: "Nosy Be",
                nom: "Lemuria Land",
                type: "Culture",
                lat: -13.3556,
                lng: 48.2834,
                prix: "30 000 Ar",
                prixEur: "7 €",
                prixNum: 30000,
                note: 4.6,
                description: "Réserve privée avec lémuriens, caméléons, reptiles endémiques. Distillerie d'ylang-ylang traditionnelle.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2398FB98' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='22' fill='white' text-anchor='middle' dy='.3em'%3ELemuria Land%3C/text%3E%3C/svg%3E",
                acces: "Route Hell-Ville - Andilana, bien indiqué",
                horaires: "8h-17h tous les jours"
            },
            {
                id: 24,
                ville: "Nosy Be",
                nom: "Plage d'Ambatoloaka",
                type: "Incontournable",
                lat: -13.3623,
                lng: 48.2812,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.5,
                description: "Plage animée, centre nocturne de Nosy Be. Restaurants, bars, beach clubs, soirées festives, ambiance conviviale.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23FFD700' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3EAmbatoloaka%3C/text%3E%3C/svg%3E",
                acces: "5 km de Hell-Ville, taxi ou location",
                horaires: "24h/24, vie nocturne dès 19h"
            },
            {
                id: 25,
                ville: "Nosy Be",
                nom: "Nosy Sakatia",
                type: "Nature",
                lat: -13.3889,
                lng: 48.2145,
                prix: "45 000 Ar",
                prixEur: "10 €",
                prixNum: 45000,
                note: 4.8,
                description: "Île sauvage préservée. Plantations de vanille, café, orchidées. Plongée exceptionnelle, tortues marines.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2340E0D0' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='22' fill='white' text-anchor='middle' dy='.3em'%3ENosy Sakatia%3C/text%3E%3C/svg%3E",
                acces: "Bateau (20 min) depuis côte ouest Nosy Be",
                horaires: "Excursion journée avec guide local"
            },
            {
                id: 26,
                ville: "Nosy Be",
                nom: "Restaurant Cacao Beach",
                type: "Restaurant",
                lat: -13.3178,
                lng: 48.2689,
                prix: "45 000 Ar",
                prixEur: "10 €",
                prixNum: 45000,
                note: 4.8,
                description: "Restaurant pieds dans le sable à Andilana. Langoustes grillées, poissons frais, cocktails, transats gratuits.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23FF6347' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='22' fill='white' text-anchor='middle' dy='.3em'%3ECacao Beach%3C/text%3E%3C/svg%3E",
                acces: "Plage d'Andilana, nord de l'île",
                horaires: "10h-22h tous les jours"
            },
            {
                id: 27,
                ville: "Nosy Be",
                nom: "Restaurant L'Heure Bleue",
                type: "Restaurant",
                lat: -13.3645,
                lng: 48.2823,
                prix: "50 000 Ar",
                prixEur: "12 €",
                prixNum: 50000,
                note: 4.9,
                description: "Gastronomie franco-malgache raffinée, vue mer, carte des vins. Ambiance romantique, terrasse panoramique.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%234169E1' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3EL'Heure Bleue%3C/text%3E%3C/svg%3E",
                acces: "Hell-Ville, près du front de mer",
                horaires: "12h-14h et 19h-22h, fermé dimanche"
            },
            {
                id: 28,
                ville: "Nosy Be",
                nom: "Plongée Nosy Be",
                type: "Culture",
                lat: -13.3634,
                lng: 48.2789,
                prix: "75 000 Ar",
                prixEur: "18 €",
                prixNum: 75000,
                note: 4.9,
                description: "2 plongées exploration niveau 1 tout compris. Sites: Tanikely, bancs de requins baleines (saison), raies manta.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%230000CD' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='22' fill='white' text-anchor='middle' dy='.3em'%3EPlongée%3C/text%3E%3C/svg%3E",
                acces: "Clubs de plongée à Madirokely, Ambatoloaka",
                horaires: "Sorties matin et après-midi"
            },
            {
                id: 29,
                ville: "Nosy Be",
                nom: "Ylang-Ylang Distillerie",
                type: "Culture",
                lat: -13.3712,
                lng: 48.2745,
                prix: "15 000 Ar",
                prixEur: "3.50 €",
                prixNum: 15000,
                note: 4.5,
                description: "Visite de distillerie traditionnelle d'ylang-ylang. Procédé ancestral, senteurs enivrantes, boutique de parfums.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23DDA0DD' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3EYlang-Ylang%3C/text%3E%3C/svg%3E",
                acces: "Plusieurs distilleries sur l'île, guides locaux",
                horaires: "8h-16h, meilleur en matinée"
            },
            {
                id: 30,
                ville: "Nosy Be",
                nom: "Grotte de la Vierge",
                type: "Spot Local",
                spotLocal: true,
                lat: -13.3456,
                lng: 48.2789,
                prix: "5 000 Ar",
                prixEur: "1 €",
                prixNum: 5000,
                note: 4.9,
                description: "Grotte marine avec autel dédié à la Vierge Marie. Accessible en pirogue, lieu de pèlerinage catholique-animiste discret.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3EGrotte Vierge%3C/text%3E%3C/svg%3E",
                acces: "En pirogue depuis plage Ambatoloaka - Contacter Marie qui loue sa pirogue et guide (cabane bleue)",
                contactLocal: "Marie, sur la plage d'Ambatoloaka, reconnaissable à sa cabane bleue",
                respect: "Bougie d'offrande recommandée (5000 Ar), silence dans la grotte, respecter les prières en cours"
            },
            
            // MAHAJANGA
            {
                id: 31,
                ville: "Mahajanga",
                nom: "Cirque Rouge",
                type: "Incontournable",
                lat: -15.6667,
                lng: 46.3167,
                prix: "8 000 Ar",
                prixEur: "2 €",
                prixNum: 8000,
                note: 4.8,
                description: "Formation géologique spectaculaire aux couleurs rouge et ocre. Coucher de soleil magique.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3ECircue Rouge%3C/text%3E%3C/svg%3E",
                acces: "12 km au nord, piste praticable",
                horaires: "Tôt le matin ou fin d'après-midi (chaleur)"
            },
            {
                id: 32,
                ville: "Mahajanga",
                nom: "Baobabs Sacrés de Mahabibo",
                type: "Nature",
                lat: -15.7167,
                lng: 46.3500,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.5,
                description: "Allée de baobabs millénaires, lieu spirituel pour les Sakalava.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23D8B48F' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='%2312100E' text-anchor='middle' dy='.3em'%3EBaobabs%3C/text%3E%3C/svg%3E",
                acces: "Route de Katsepy, 15 km",
                horaires: "Lever et coucher de soleil recommandés"
            },
            {
                id: 33,
                ville: "Mahajanga",
                nom: "Source Sacrée de Marovoay",
                type: "Spot Local",
                spotLocal: true,
                lat: -15.7234,
                lng: 46.3678,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.7,
                description: "Source d'eau douce vénérée, lieu de rituels traditionnels Sakalava.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3ESource Sacrée%3C/text%3E%3C/svg%3E",
                acces: "Près de l'école primaire de Marovoay, chemin de terre à gauche après le pont",
                contactLocal: "Demander au directeur de l'école qui indique le chemin",
                respect: "Offrande traditionnelle obligatoire (rhum, miel), ne pas se baigner"
            },
            {
                id: 34,
                ville: "Mahajanga",
                nom: "Plage de Mahajanga",
                type: "Incontournable",
                lat: -15.7167,
                lng: 46.3167,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.6,
                description: "Grande plage urbaine avec le célèbre Baobab Amoureux. Couchers de soleil spectaculaires, promenade bordée de palmiers.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2300BFFF' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EPlage Mahajanga%3C/text%3E%3C/svg%3E",
                acces: "Centre-ville, front de mer (boulevard Poincaré)",
                horaires: "Accessible 24h/24, meilleur au coucher de soleil"
            },
            {
                id: 35,
                ville: "Mahajanga",
                nom: "Parc National d'Ankarafantsika",
                type: "Nature",
                lat: -16.3167,
                lng: 46.8167,
                prix: "45 000 Ar",
                prixEur: "10 €",
                prixNum: 45000,
                note: 4.8,
                description: "Parc national à 115 km. 8 espèces de lémuriens, 129 espèces d'oiseaux, lac Ravelobe, forêt sèche unique.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%233A5F3A' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='18' fill='white' text-anchor='middle' dy='.3em'%3EAnkarafantsika%3C/text%3E%3C/svg%3E",
                acces: "115 km sur RN4, accessible en taxi-brousse ou 4x4",
                horaires: "7h-17h avec guide obligatoire"
            },
            {
                id: 36,
                ville: "Mahajanga",
                nom: "Katsepy et le Phare",
                type: "Nature",
                lat: -15.7456,
                lng: 46.2234,
                prix: "15 000 Ar",
                prixEur: "3.50 €",
                prixNum: 15000,
                note: 4.5,
                description: "Traversée en bac vers Katsepy. Plage tranquille, phare historique, village de pêcheurs authentique.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%234682B4' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EKatsepy%3C/text%3E%3C/svg%3E",
                acces: "Bac depuis le port de Mahajanga (30 min de traversée)",
                horaires: "Bacs : 6h, 8h, 11h, 14h, 16h"
            },
            {
                id: 37,
                ville: "Mahajanga",
                nom: "Grotte d'Anjohibe",
                type: "Nature",
                lat: -15.5234,
                lng: 46.8567,
                prix: "35 000 Ar",
                prixEur: "8 €",
                prixNum: 35000,
                note: 4.7,
                description: "Immense grotte calcaire avec stalactites et stalagmites. Rivière souterraine, formations géologiques spectaculaires.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%238B4513' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EGrotte Anjohibe%3C/text%3E%3C/svg%3E",
                acces: "85 km sur RN4 puis piste. Excursion journée avec guide local",
                horaires: "Excursion départ 7h, retour 17h"
            },
            {
                id: 38,
                ville: "Mahajanga",
                nom: "Restaurant Chez Karon",
                type: "Restaurant",
                lat: -15.7178,
                lng: 46.3189,
                prix: "35 000 Ar",
                prixEur: "8 €",
                prixNum: 35000,
                note: 4.8,
                description: "Restaurant emblématique de Mahajanga. Spécialités fruits de mer, langoustes, crabes farcis. Vue sur mer.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23FF6347' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='22' fill='white' text-anchor='middle' dy='.3em'%3EChez Karon%3C/text%3E%3C/svg%3E",
                acces: "Boulevard Poincaré, front de mer",
                horaires: "11h-22h tous les jours"
            },
            {
                id: 39,
                ville: "Mahajanga",
                nom: "Marché Couvert de Mahajanga",
                type: "Culture",
                lat: -15.7156,
                lng: 46.3145,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.4,
                description: "Marché traditionnel animé. Épices, fruits exotiques, poissons frais, artisanat Sakalava. Ambiance authentique.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23D8B48F' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='%2312100E' text-anchor='middle' dy='.3em'%3EMarché Couvert%3C/text%3E%3C/svg%3E",
                acces: "Centre-ville, rue du Commerce",
                horaires: "5h-18h, meilleur en matinée"
            },
            {
                id: 40,
                ville: "Mahajanga",
                nom: "Complexe Sportif Ankorondrano",
                type: "Culture",
                lat: -15.7234,
                lng: 46.3212,
                prix: "5 000 Ar",
                prixEur: "1 €",
                prixNum: 5000,
                note: 4.3,
                description: "Complexe avec piscine olympique, terrain de beach-volley. Idéal pour se rafraîchir après les visites.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2300CED1' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3EComplexe Sportif%3C/text%3E%3C/svg%3E",
                acces: "Quartier Ankorondrano, bien indiqué",
                horaires: "8h-18h en semaine, 8h-20h weekend"
            },
            
            // ANDASIBE
            {
                id: 15,
                ville: "Andasibe",
                nom: "Parc National Andasibe-Mantadia",
                type: "Incontournable",
                lat: -18.9333,
                lng: 48.4167,
                prix: "55 000 Ar",
                prixEur: "13 €",
                prixNum: 55000,
                note: 4.9,
                description: "Forêt primaire avec Indri-Indri (plus grand lémurien), orchidées, caméléons.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%233A5F3A' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EAndasibe%3C/text%3E%3C/svg%3E",
                acces: "RN2, 140 km d'Antananarivo (3h)",
                horaires: "Circuits 4h à 6h avec guide obligatoire"
            },
            {
                id: 16,
                ville: "Andasibe",
                nom: "Réserve de Vakona",
                type: "Nature",
                lat: -18.9456,
                lng: 48.4289,
                prix: "30 000 Ar",
                prixEur: "7 €",
                prixNum: 30000,
                note: 4.6,
                description: "Île aux lémuriens apprivoisés. Contact rapproché avec plusieurs espèces.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%233A5F3A' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EVakona%3C/text%3E%3C/svg%3E",
                acces: "À côté du parc, bien indiqué",
                horaires: "8h-17h tous les jours"
            },
            {
                id: 17,
                ville: "Andasibe",
                nom: "Cascade Cachée",
                type: "Spot Local",
                spotLocal: true,
                lat: -18.9389,
                lng: 48.4312,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.8,
                description: "Cascade isolée dans la forêt, bassin naturel pour baignade. Très peu fréquentée.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3ECascade Secrète%3C/text%3E%3C/svg%3E",
                acces: "Sentier derrière le Lodge Vakona (non balisé) - Demander Jean, guide local qui connaît le chemin",
                contactLocal: "Jean, guide à l'entrée de Vakona (gilet orange)",
                respect: "Ne pas laisser de déchets, baignade autorisée"
            },
            
            // ISALO
            {
                id: 18,
                ville: "Isalo",
                nom: "Parc National de l'Isalo",
                type: "Incontournable",
                lat: -22.5500,
                lng: 45.3667,
                prix: "55 000 Ar",
                prixEur: "13 €",
                prixNum: 55000,
                note: 4.9,
                description: "Massif de grès ruiniforme, canyons, piscines naturelles, lémuriens catta.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23D8B48F' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='%2312100E' text-anchor='middle' dy='.3em'%3EIsalo%3C/text%3E%3C/svg%3E",
                acces: "RN7, entre Tuléar et Fianarantsoa",
                horaires: "Circuits à la journée avec guide obligatoire"
            },
            {
                id: 19,
                ville: "Isalo",
                nom: "Piscine Naturelle",
                type: "Nature",
                lat: -22.5734,
                lng: 45.3812,
                prix: "Inclus parc",
                prixEur: "Inclus",
                prixNum: 0,
                note: 4.8,
                description: "Bassin d'eau claire au pied d'une cascade. Baignade rafraîchissante après randonnée.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2300BFFF' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3EPiscine Naturelle%3C/text%3E%3C/svg%3E",
                acces: "Circuit de 2-3h dans le parc",
                horaires: "Matin recommandé (moins de monde)"
            },
            {
                id: 20,
                ville: "Isalo",
                nom: "Point de Vue Secret du Canyon",
                type: "Spot Local",
                spotLocal: true,
                lat: -22.5678,
                lng: 45.3945,
                prix: "10 000 Ar",
                prixEur: "2 €",
                prixNum: 10000,
                note: 4.9,
                description: "Point de vue panoramique hors sentiers touristiques. Vue à 360° sur les canyons.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='18' fill='white' text-anchor='middle' dy='.3em'%3EPoint Vue Secret%3C/text%3E%3C/svg%3E",
                acces: "Sentier non balisé à 500m de la Fenêtre de l'Isalo - Guide familial obligatoire",
                contactLocal: "Famille Rakoto au village de Ranohira, demander 'Papa Koto'",
                respect: "Coucher de soleil uniquement, ne pas sortir du sentier"
            },
            
            // IFATY
            {
                id: 21,
                ville: "Ifaty",
                nom: "Plage d'Ifaty",
                type: "Incontournable",
                lat: -23.1500,
                lng: 43.6167,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.7,
                description: "Plage de sable blanc bordée de baobabs. Snorkeling sur le récif corallien.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2300BFFF' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EIfaty Beach%3C/text%3E%3C/svg%3E",
                acces: "27 km au nord de Tuléar par piste",
                horaires: "Accessible 24h/24"
            },
            {
                id: 22,
                ville: "Ifaty",
                nom: "Forêt de Baobabs de Mangily",
                type: "Nature",
                lat: -23.1667,
                lng: 43.6000,
                prix: "15 000 Ar",
                prixEur: "3.50 €",
                prixNum: 15000,
                note: 4.6,
                description: "Forêt sèche avec baobabs endémiques, oiseaux rares, plantes succulentes.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23D8B48F' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='%2312100E' text-anchor='middle' dy='.3em'%3EForêt Baobabs%3C/text%3E%3C/svg%3E",
                acces: "Village de Mangily, guide local recommandé",
                horaires: "Matin ou fin d'après-midi (chaleur)"
            },
            {
                id: 23,
                ville: "Ifaty",
                nom: "Arbre Millénaire Sacré",
                type: "Spot Local",
                spotLocal: true,
                lat: -23.1723,
                lng: 43.5978,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.9,
                description: "Baobab millénaire vénéré par les Vezo. Lieu de cérémonies traditionnelles.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='18' fill='white' text-anchor='middle' dy='.3em'%3EBaobab Sacré%3C/text%3E%3C/svg%3E",
                acces: "Intérieur des terres à 2 km d'Ifaty - Pas de panneau, chef du village montre le chemin",
                contactLocal: "Chef du village d'Ifaty (mairie)",
                respect: "Offrande traditionnelle obligatoire (rhum, tabac), ne pas toucher l'arbre"
            },
            
            // ANKARANA
            {
                id: 24,
                ville: "Ankarana",
                nom: "Tsingy Gris d'Ankarana",
                type: "Incontournable",
                lat: -12.9167,
                lng: 49.1167,
                prix: "65 000 Ar",
                prixEur: "15 €",
                prixNum: 65000,
                note: 4.9,
                description: "Formations calcaires acérées spectaculaires. Ponts suspendus, grottes.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23D8B48F' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='%2312100E' text-anchor='middle' dy='.3em'%3ETsingy%3C/text%3E%3C/svg%3E",
                acces: "108 km au sud de Diego-Suarez",
                horaires: "Circuits guidés, harnais fourni"
            },
            {
                id: 25,
                ville: "Ankarana",
                nom: "Grottes des Chauves-Souris",
                type: "Nature",
                lat: -12.9234,
                lng: 49.1289,
                prix: "Inclus parc",
                prixEur: "Inclus",
                prixNum: 0,
                note: 4.7,
                description: "Réseau de grottes avec stalactites, stalagmites, colonies de chauves-souris.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%232D2D2D' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EGrottes%3C/text%3E%3C/svg%3E",
                acces: "Sentier depuis l'entrée du parc",
                horaires: "Lampe frontale obligatoire"
            },
            {
                id: 26,
                ville: "Ankarana",
                nom: "Grotte Interdite (Anjohibe)",
                type: "Spot Local",
                spotLocal: true,
                lat: -12.9312,
                lng: 49.1345,
                prix: "20 000 Ar",
                prixEur: "5 €",
                prixNum: 20000,
                note: 4.8,
                description: "Grotte sacrée avec tombeaux ancestraux Antakarana. Accès restreint.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3EGrotte Interdite%3C/text%3E%3C/svg%3E",
                acces: "Autorisation du chef Antakarana obligatoire - Contacter Papa Solo à Antsiranana qui organise",
                contactLocal: "Papa Solo (guide agréé), bureau près du marché central Diego",
                respect: "Interdiction photos, offrande obligatoire, vêtements couvrants"
            },
            
            // MANANARA
            {
                id: 27,
                ville: "Mananara",
                nom: "Parc National Mananara-Nord",
                type: "Incontournable",
                lat: -16.1667,
                lng: 49.7667,
                prix: "45 000 Ar",
                prixEur: "10 €",
                prixNum: 45000,
                note: 4.6,
                description: "Parc marin et terrestre. Aye-aye (lémurien nocturne), baleines (juillet-septembre).",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%233A5F3A' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='24' fill='white' text-anchor='middle' dy='.3em'%3EMananara%3C/text%3E%3C/svg%3E",
                acces: "Côte est, 250 km de Toamasina (difficile)",
                horaires: "Excursions guidées"
            },
            {
                id: 28,
                ville: "Mananara",
                nom: "Île aux Nattes",
                type: "Nature",
                lat: -16.1456,
                lng: 49.7845,
                prix: "10 000 Ar",
                prixEur: "2 €",
                prixNum: 10000,
                note: 4.7,
                description: "Îlot accessible en pirogue. Plage déserte, snorkeling exceptionnel.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%2300BFFF' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='white' text-anchor='middle' dy='.3em'%3EÎle aux Nattes%3C/text%3E%3C/svg%3E",
                acces: "Pirogue depuis Mananara (15 min)",
                horaires: "Départs matin et après-midi"
            },
            {
                id: 29,
                ville: "Mananara",
                nom: "Lac aux Crocodiles Sacrés",
                type: "Spot Local",
                spotLocal: true,
                lat: -16.1734,
                lng: 49.7612,
                prix: "Gratuit",
                prixEur: "Gratuit",
                prixNum: 0,
                note: 4.8,
                description: "Lac habité par crocodiles vénérés comme ancêtres. Site sacré Betsimisaraka.",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect fill='%23C13535' width='400' height='200'/%3E%3Ctext x='50%25' y='50%25' font-size='18' fill='white' text-anchor='middle' dy='.3em'%3ELac Sacré%3C/text%3E%3C/svg%3E",
                acces: "Forêt à 5 km de Mananara, sentier depuis le village - Parler au gardien du lac",
                contactLocal: "Gardien au village (maison toit rouge)",
                respect: "Interdiction formelle de photographier, ne pas montrer du doigt, offrande requise"
            }
        ];
        
        const PHRASES_DATA = {
            "Salutations & Politesse": [
                { fr: "Bonjour", mg: "Manao ahoana", phonetic: "man-ao a-ho-ana" },
                { fr: "Merci", mg: "Misaotra", phonetic: "mi-sao-tra" },
                { fr: "S'il vous plaît", mg: "Azafady", phonetic: "a-za-fa-dy" },
                { fr: "Excusez-moi", mg: "Miala tsiny", phonetic: "mi-a-la tsi-ny" },
                { fr: "Au revoir", mg: "Veloma", phonetic: "ve-lo-ma" },
                { fr: "Oui", mg: "Eny", phonetic: "e-ny" },
                { fr: "Non", mg: "Tsia", phonetic: "tsi-a" }
            ],
            "Se présenter": [
                { fr: "Je m'appelle...", mg: "[Nom] no anarako", phonetic: "[nom] no a-na-ra-ko" },
                { fr: "Je suis français(e)", mg: "Frantsay aho", phonetic: "fran-tsaï a-ho" },
                { fr: "Je ne parle pas malgache", mg: "Tsy mahay miteny malagasy aho", phonetic: "tsi ma-haï mi-te-ny ma-la-ga-sy a-ho" },
                { fr: "Je suis en vacances", mg: "Miala sasatra aho", phonetic: "mi-a-la sa-sa-tra a-ho" },
                { fr: "Enchanté(e)", mg: "Faly mahafantatra anao", phonetic: "fa-ly ma-ha-fan-ta-tra a-nao" }
            ],
            "Se déplacer": [
                { fr: "Où est la plage ?", mg: "Aiza ny moron-dranomasina ?", phonetic: "aï-za ni mo-ron-dra-no-ma-si-na" },
                { fr: "Combien pour Diego ?", mg: "Hoatrinona ny ho any Antsiranana ?", phonetic: "ho-a-tri-no-na ni ho a-ny an-tsi-ra-na-na" },
                { fr: "Je suis perdu(e)", mg: "Very làlana aho", phonetic: "ve-ry la-la-na a-ho" },
                { fr: "C'est loin ?", mg: "Lavitra ve ?", phonetic: "la-vi-tra ve" },
                { fr: "À droite", mg: "Havanana", phonetic: "ha-va-na-na" },
                { fr: "À gauche", mg: "Havia", phonetic: "hi-vi-a" },
                { fr: "Tout droit", mg: "Mahitsy", phonetic: "ma-hit-sy" },
                { fr: "Arrêtez ici", mg: "Mijanona eto", phonetic: "mi-ja-no-na e-to" }
            ],
            "Négocier & Acheter": [
                { fr: "Combien ça coûte ?", mg: "Ohatrinona ny vidiny ?", phonetic: "o-ha-tri-no-na ni vi-di-ny" },
                { fr: "C'est trop cher", mg: "Lafo be loatra izany", phonetic: "la-fo be lo-a-tra i-za-ny" },
                { fr: "Moins cher possible ?", mg: "Mora kokoa ve ?", phonetic: "mo-ra ko-ko-a ve" },
                { fr: "Je prends ça", mg: "Alako io", phonetic: "a-la-ko i-o" },
                { fr: "Vous acceptez les euros ?", mg: "Mandray euros ve ianao ?", phonetic: "man-draï e-u-ros ve i-a-nao" },
                { fr: "Pas de monnaie", mg: "Tsy misy vola madinika", phonetic: "tsi mi-sy vo-la ma-di-ni-ka" }
            ],
            "Restaurant": [
                { fr: "Une table pour deux", mg: "Latabatra roa azafady", phonetic: "la-ta-ba-tra ro-a a-za-fa-dy" },
                { fr: "Le menu s'il vous plaît", mg: "Ny menu azafady", phonetic: "ni me-nu a-za-fa-dy" },
                { fr: "L'addition", mg: "Ny faktiora", phonetic: "ni fak-ti-o-ra" },
                { fr: "C'était délicieux", mg: "Matsiro be", phonetic: "ma-tsi-ro be" },
                { fr: "Eau minérale", mg: "Rano mineraly", phonetic: "ra-no mi-ne-ra-ly" },
                { fr: "Sans piment", mg: "Tsy misy sakay", phonetic: "tsi mi-sy sa-kaï" },
                { fr: "Je suis végétarien(ne)", mg: "Tsy mihinana hena aho", phonetic: "tsi mi-hi-na-na he-na a-ho" }
            ],
            "Nombres": [
                { fr: "1", mg: "Iray", phonetic: "i-raï" },
                { fr: "2", mg: "Roa", phonetic: "ro-a" },
                { fr: "3", mg: "Telo", phonetic: "te-lo" },
                { fr: "4", mg: "Efatra", phonetic: "e-fa-tra" },
                { fr: "5", mg: "Dimy", phonetic: "di-my" },
                { fr: "10", mg: "Folo", phonetic: "fo-lo" },
                { fr: "100", mg: "Zato", phonetic: "za-to" },
                { fr: "1 000", mg: "Arivo", phonetic: "a-ri-vo" }
            ],
            "Urgence & Santé": [
                { fr: "Aidez-moi !", mg: "Vonjeo aho !", phonetic: "von-je-o a-ho" },
                { fr: "Mal à la tête", mg: "Marary ny lohako", phonetic: "ma-ra-ry ni lo-ha-ko" },
                { fr: "Où est la pharmacie ?", mg: "Aiza ny fivarotam-panafody ?", phonetic: "aï-za ni fi-va-ro-tam-fa-na-fo-dy" },
                { fr: "Hôpital", mg: "Hopitaly", phonetic: "ho-pi-ta-ly" },
                { fr: "J'ai besoin d'un docteur", mg: "Mila dokotera aho", phonetic: "mi-la do-ko-te-ra a-ho" },
                { fr: "Allergie", mg: "Alerizy", phonetic: "a-le-ri-zy" }
            ],
            "Hébergement & Météo": [
                { fr: "Hôtel", mg: "Hotely", phonetic: "ho-te-ly" },
                { fr: "Chambre", mg: "Efitrano", phonetic: "e-fi-tra-no" },
                { fr: "Il fait chaud", mg: "Mafana", phonetic: "ma-fa-na" },
                { fr: "Il pleut", mg: "Avy ny orana", phonetic: "a-vy ni o-ra-na" }
            ]
        };
        
        const CHECKLIST_ITEMS = [
            "SIM locale Telma",
            "Argent liquide (CB rare)",
            "Adaptateur prise C/E",
            "Crème solaire SPF50+",
            "Lampe frontale",
            "Carnet + stylo",
            "Powerbank 20 000 mAh",
            "Sac étanche",
            "Répulsif anti-moustiques",
            "Trousse premiers secours"
        ];
        
        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        
        let map;
        let markersLayer;
        let currentTheme = localStorage.getItem('theme') || 'light';
        let exchangeRate = parseFloat(localStorage.getItem('exchangeRate')) || 4250;
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let checklist = JSON.parse(localStorage.getItem('checklist')) || [];
        let deferredPrompt;
        
        // ============================================
        // INITIALISATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initNavigation();
            initMap();
            initLanguePage();
            initOutilsPage();
            initCityPages();
            initSpotsPage();
            initModal();
            initInstallPrompt();
            registerServiceWorker();
        });
        
        // ============================================
        // THÈME
        // ============================================
        
        function initTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeToggle();
            
            document.getElementById('themeToggle').addEventListener('click', () => {
                currentTheme = currentTheme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', currentTheme);
                localStorage.setItem('theme', currentTheme);
                updateThemeToggle();
            });
        }
        
        function updateThemeToggle() {
            const toggle = document.getElementById('themeToggle');
            toggle.textContent = currentTheme === 'light' ? '☀️' : '🌙';
        }
        
        // ============================================
        // NAVIGATION
        // ============================================
        
        function initNavigation() {
            const navBtns = document.querySelectorAll('.nav-btn');
            const shortcuts = document.querySelectorAll('.shortcut-card');
            
            navBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const page = btn.dataset.page;
                    navigateToPage(page);
                });
            });
            
            shortcuts.forEach(card => {
                card.addEventListener('click', () => {
                    const page = card.dataset.goto;
                    navigateToPage(page);
                });
            });
        }
        
        function navigateToPage(pageName) {
            // Cacher toutes les sections
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Retirer active de tous les boutons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Afficher la section demandée
            const pageSection = document.getElementById(`page-${pageName}`);
            if (pageSection) {
                pageSection.classList.add('active');
            }
            
            // Activer le bouton correspondant
            const activeBtn = document.querySelector(`[data-page="${pageName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
            
            // Scroll en haut
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // ============================================
        // CARTE
        // ============================================
        
        function initMap() {
            map = L.map('map').setView([-18.8792, 47.5079], 6);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(map);
            
            markersLayer = L.markerClusterGroup({
                chunkedLoading: true,
                spiderfyOnMaxZoom: true,
                showCoverageOnHover: false,
                zoomToBoundsOnClick: true
            });
            
            updateMapMarkers();
            map.addLayer(markersLayer);
            
            // Filtres
            document.querySelectorAll('.filter-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', updateMapMarkers);
            });
        }
        
        function updateMapMarkers() {
            markersLayer.clearLayers();
            
            const filters = getActiveFilters();
            const filteredLieux = LIEUX_DATA.filter(lieu => matchesFilters(lieu, filters));
            
            filteredLieux.forEach(lieu => {
                const icon = L.divIcon({
                    className: 'custom-marker',
                    html: lieu.spotLocal ? '📍' : '📌',
                    iconSize: [32, 32]
                });
                
                const marker = L.marker([lieu.lat, lieu.lng], { icon });
                
                const popupContent = `
                    <div class="popup-content">
                        <div class="popup-title">${lieu.nom}</div>
                        <div class="popup-price">${lieu.prix} (${lieu.prixEur})</div>
                        <div class="popup-rating">⭐ ${lieu.note}</div>
                        ${lieu.spotLocal ? '<div class="badge-spot">📍 Spot Local</div>' : ''}
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                marker.on('click', () => showLieuDetails(lieu));
                
                markersLayer.addLayer(marker);
            });
        }
        
        function getActiveFilters() {
            const filters = {
                villes: [],
                types: [],
                prix: []
            };
            
            // Villes
            document.querySelectorAll('[id^="filter-"][id$="antananarivo"], [id$="diego"], [id$="nosybe"], [id$="mahajanga"], [id$="andasibe"], [id$="isalo"], [id$="ifaty"], [id$="ankarana"], [id$="mananara"]').forEach(cb => {
                if (cb.checked) {
                    const ville = cb.id.replace('filter-', '');
                    const villeMap = {
                        'antananarivo': 'Antananarivo',
                        'diego': 'Diego-Suarez',
                        'nosybe': 'Nosy Be',
                        'mahajanga': 'Mahajanga',
                        'andasibe': 'Andasibe',
                        'isalo': 'Isalo',
                        'ifaty': 'Ifaty',
                        'ankarana': 'Ankarana',
                        'mananara': 'Mananara'
                    };
                    filters.villes.push(villeMap[ville]);
                }
            });
            
            // Types
            if (document.getElementById('filter-incontournable').checked) filters.types.push('Incontournable');
            if (document.getElementById('filter-spotlocal').checked) filters.types.push('Spot Local');
            if (document.getElementById('filter-nature').checked) filters.types.push('Nature');
            if (document.getElementById('filter-restaurant').checked) filters.types.push('Restaurant');
            if (document.getElementById('filter-culture').checked) filters.types.push('Culture');
            
            // Prix
            if (document.getElementById('filter-gratuit').checked) filters.prix.push('gratuit');
            if (document.getElementById('filter-economique').checked) filters.prix.push('economique');
            if (document.getElementById('filter-moyen').checked) filters.prix.push('moyen');
            
            return filters;
        }
        
        function matchesFilters(lieu, filters) {
            // Ville
            if (filters.villes.length > 0 && !filters.villes.includes(lieu.ville)) {
                return false;
            }
            
            // Type
            if (filters.types.length > 0) {
                const lieuTypes = [lieu.type];
                if (lieu.spotLocal) lieuTypes.push('Spot Local');
                if (!lieuTypes.some(t => filters.types.includes(t))) {
                    return false;
                }
            }
            
            // Prix
            if (filters.prix.length > 0) {
                let prixCategory;
                if (lieu.prixNum === 0) prixCategory = 'gratuit';
                else if (lieu.prixNum < 10000) prixCategory = 'economique';
                else prixCategory = 'moyen';
                
                if (!filters.prix.includes(prixCategory)) {
                    return false;
                }
            }
            
            return true;
        }
        
        // ============================================
        // PAGES VILLES
        // ============================================
        
        function initCityPages() {
            // Mapping explicite ville → ID de page HTML
            const villeToPageId = {
                'Antananarivo': 'page-antananarivo',
                'Diego-Suarez': 'page-diego',
                'Nosy Be': 'page-nosybe',
                'Mahajanga': 'page-mahajanga',
                'Andasibe': 'page-andasibe',
                'Isalo': 'page-isalo',
                'Ifaty': 'page-ifaty',
                'Ankarana': 'page-ankarana',
                'Mananara': 'page-mananara'
            };
            
            Object.keys(villeToPageId).forEach(ville => {
                const pageId = villeToPageId[ville];
                const pageElement = document.getElementById(pageId);
                if (!pageElement) {
                    console.warn(`Page non trouvée pour ${ville} (ID: ${pageId})`);
                    return;
                }
                
                const lieuxVille = LIEUX_DATA.filter(l => l.ville === ville);
                
                const html = `
                    <h2 style="font-family: var(--font-display); font-size: 2rem; margin-bottom: 30px; color: var(--text-primary);">
                        ${getVilleEmoji(ville)} ${ville}
                    </h2>
                    <div class="lieux-grid">
                        ${lieuxVille.map(lieu => createLieuCard(lieu)).join('')}
                    </div>
                `;
                
                pageElement.innerHTML = html;
                
                // Event listeners
                pageElement.querySelectorAll('.btn-details').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const lieuId = parseInt(e.target.dataset.lieuId);
                        const lieu = LIEUX_DATA.find(l => l.id === lieuId);
                        if (lieu) showLieuDetails(lieu);
                    });
                });
            });
        }
        
        function getVilleEmoji(ville) {
            const emojis = {
                'Antananarivo': '🏛️',
                'Diego-Suarez': '🏝️',
                'Nosy Be': '🌴',
                'Mahajanga': '🌊',
                'Andasibe': '🌿',
                'Isalo': '🏜️',
                'Ifaty': '🏖️',
                'Ankarana': '🕳️',
                'Mananara': '🐊'
            };
            return emojis[ville] || '📍';
        }
        
        function createLieuCard(lieu) {
            const prixClass = lieu.prixNum === 0 ? 'gratuit' : lieu.prixNum < 10000 ? 'abordable' : 'premium';
            
            return `
                <article class="lieu-card">
                    <img src="${lieu.image}" alt="${lieu.nom}" class="lieu-image" loading="lazy">
                    <div class="lieu-content">
                        <div class="lieu-header">
                            <h3 class="lieu-title">${lieu.nom}</h3>
                            ${lieu.spotLocal ? '<span class="badge-spot">📍 Spot Local</span>' : `<span class="badge-type">${lieu.type}</span>`}
                        </div>
                        <div class="lieu-meta">
                            <span class="lieu-prix ${prixClass}">${lieu.prix}</span>
                            <span class="lieu-note">⭐ ${lieu.note}</span>
                        </div>
                        <p class="lieu-desc">${lieu.description}</p>
                        <button class="btn-details" data-lieu-id="${lieu.id}">Voir détails</button>
                    </div>
                </article>
            `;
        }
        
        // ============================================
        // PAGE SPOTS LOCAUX
        // ============================================
        
        function initSpotsPage() {
            const spotsContainer = document.getElementById('spotsContainer');
            const spots = LIEUX_DATA.filter(l => l.spotLocal);
            
            spotsContainer.innerHTML = spots.map(lieu => createLieuCard(lieu)).join('');
            
            spotsContainer.querySelectorAll('.btn-details').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const lieuId = parseInt(e.target.dataset.lieuId);
                    const lieu = LIEUX_DATA.find(l => l.id === lieuId);
                    if (lieu) showLieuDetails(lieu);
                });
            });
        }
        
        // ============================================
        // MODAL
        // ============================================
        
        function initModal() {
            const modal = document.getElementById('modal');
            const closeBtn = document.getElementById('modalClose');
            
            closeBtn.addEventListener('click', () => {
                modal.classList.remove('active');
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        }
        
        function showLieuDetails(lieu) {
            const modal = document.getElementById('modal');
            const modalImage = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalTitle');
            const modalBadges = document.getElementById('modalBadges');
            const modalInfoGrid = document.getElementById('modalInfoGrid');
            const modalSections = document.getElementById('modalSections');
            
            modalImage.src = lieu.image;
            modalImage.alt = lieu.nom;
            modalTitle.textContent = lieu.nom;
            
            // Badges
            let badgesHTML = '';
            if (lieu.spotLocal) {
                badgesHTML += '<span class="badge-spot">📍 Spot Local</span> ';
            }
            badgesHTML += `<span class="badge-type">${lieu.type}</span>`;
            modalBadges.innerHTML = badgesHTML;
            
            // Infos grille
            modalInfoGrid.innerHTML = `
                <div class="modal-info-item">
                    <div class="modal-info-label">Ville</div>
                    <div class="modal-info-value">${lieu.ville}</div>
                </div>
                <div class="modal-info-item">
                    <div class="modal-info-label">Prix</div>
                    <div class="modal-info-value">${lieu.prix} (${lieu.prixEur})</div>
                </div>
                <div class="modal-info-item">
                    <div class="modal-info-label">Note</div>
                    <div class="modal-info-value">⭐ ${lieu.note}</div>
                </div>
            `;
            
            // Sections
            let sectionsHTML = `
                <div class="modal-section">
                    <div class="modal-section-title">Description</div>
                    <div class="modal-section-content">${lieu.description}</div>
                </div>
                <div class="modal-section">
                    <div class="modal-section-title">Accès</div>
                    <div class="modal-section-content">${lieu.acces}</div>
                </div>
            `;
            
            if (lieu.horaires) {
                sectionsHTML += `
                    <div class="modal-section">
                        <div class="modal-section-title">Horaires</div>
                        <div class="modal-section-content">${lieu.horaires}</div>
                    </div>
                `;
            }
            
            if (lieu.contactLocal) {
                sectionsHTML += `
                    <div class="modal-section">
                        <div class="modal-section-title">Contact Local</div>
                        <div class="modal-section-content">${lieu.contactLocal}</div>
                    </div>
                `;
            }
            
            if (lieu.respect) {
                sectionsHTML += `
                    <div class="modal-section">
                        <div class="modal-section-title">⚠️ Respect Requis</div>
                        <div class="modal-section-content">${lieu.respect}</div>
                    </div>
                `;
            }
            
            modalSections.innerHTML = sectionsHTML;
            
            modal.classList.add('active');
        }
        
        // ============================================
        // PAGE LANGUE
        // ============================================
        
        function initLanguePage() {
            const container = document.getElementById('accordionContainer');
            const searchInput = document.getElementById('langueSearch');
            
            Object.keys(PHRASES_DATA).forEach((category, index) => {
                const accordionHTML = createAccordion(category, PHRASES_DATA[category], index);
                container.insertAdjacentHTML('beforeend', accordionHTML);
            });
            
            // Event listeners accordéons
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const item = header.parentElement;
                    const wasOpen = item.classList.contains('open');
                    
                    // Fermer tous
                    document.querySelectorAll('.accordion-item').forEach(i => i.classList.remove('open'));
                    
                    // Ouvrir celui-ci si fermé
                    if (!wasOpen) {
                        item.classList.add('open');
                    }
                });
            });
            
            // Recherche
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                document.querySelectorAll('.phrase-item').forEach(item => {
                    const fr = item.querySelector('.phrase-fr').textContent.toLowerCase();
                    const mg = item.querySelector('.phrase-mg').textContent.toLowerCase();
                    if (fr.includes(query) || mg.includes(query)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
            
            // Boutons actions phrases
            container.addEventListener('click', (e) => {
                if (e.target.classList.contains('btn-audio')) {
                    playAudio(e.target.dataset.text);
                } else if (e.target.classList.contains('btn-copy')) {
                    copyToClipboard(e.target.dataset.text);
                } else if (e.target.classList.contains('btn-favorite')) {
                    toggleFavorite(e.target);
                }
            });
        }
        
        function createAccordion(category, phrases, index) {
            const phrasesHTML = phrases.map((phrase, i) => `
                <div class="phrase-item">
                    <div class="phrase-content">
                        <div class="phrase-fr">${phrase.fr}</div>
                        <div class="phrase-mg">${phrase.mg}</div>
                        <div class="phrase-phonetic">(${phrase.phonetic})</div>
                    </div>
                    <div class="phrase-actions">
                        <button class="btn-icon btn-audio" data-text="${phrase.mg}" title="Écouter">🔊</button>
                        <button class="btn-icon btn-copy" data-text="${phrase.mg}" title="Copier">📋</button>
                        <button class="btn-icon btn-favorite ${favorites.includes(`${category}-${i}`) ? 'active' : ''}" data-category="${category}" data-index="${i}" title="Favori">⭐</button>
                    </div>
                </div>
            `).join('');
            
            return `
                <div class="accordion-item ${index === 0 ? 'open' : ''}">
                    <div class="accordion-header">
                        <h3 class="accordion-title">
                            ${getCategoryEmoji(category)} ${category}
                        </h3>
                        <span class="accordion-icon">▼</span>
                    </div>
                    <div class="accordion-body">
                        <div class="accordion-content">
                            ${phrasesHTML}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getCategoryEmoji(category) {
            const emojis = {
                "Salutations & Politesse": "👋",
                "Se présenter": "🙋",
                "Se déplacer": "🚶",
                "Négocier & Acheter": "💰",
                "Restaurant": "🍽️",
                "Nombres": "🔢",
                "Urgence & Santé": "🚨"
            };
            return emojis[category] || "💬";
        }
        
        function playAudio(text) {
            // Simulation audio (Speech Synthesis API)
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'mg-MG';
            utterance.rate = 0.8;
            window.speechSynthesis.speak(utterance);
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Feedback visuel
                alert('Copié dans le presse-papiers !');
            });
        }
        
        function toggleFavorite(btn) {
            const key = `${btn.dataset.category}-${btn.dataset.index}`;
            const index = favorites.indexOf(key);
            
            if (index > -1) {
                favorites.splice(index, 1);
                btn.classList.remove('active');
            } else {
                favorites.push(key);
                btn.classList.add('active');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }
        
        // ============================================
        // PAGE OUTILS
        // ============================================
        
        function initOutilsPage() {
            // Convertisseur
            const inputAr = document.getElementById('inputAr');
            const inputEuro = document.getElementById('inputEuro');
            const rateDisplay = document.getElementById('rateDisplay');
            const btnModifyRate = document.getElementById('btnModifyRate');
            
            rateDisplay.textContent = exchangeRate;
            
            inputAr.addEventListener('input', () => {
                const ar = parseFloat(inputAr.value) || 0;
                inputEuro.value = (ar / exchangeRate).toFixed(2);
            });
            
            inputEuro.addEventListener('input', () => {
                const euro = parseFloat(inputEuro.value) || 0;
                inputAr.value = Math.round(euro * exchangeRate);
            });
            
            btnModifyRate.addEventListener('click', () => {
                const newRate = prompt('Entrez le nouveau taux (1 € = X Ar)', exchangeRate);
                if (newRate && !isNaN(newRate)) {
                    exchangeRate = parseFloat(newRate);
                    localStorage.setItem('exchangeRate', exchangeRate);
                    rateDisplay.textContent = exchangeRate;
                    // Recalculer
                    inputAr.dispatchEvent(new Event('input'));
                }
            });
            
            // Checklist
            const checklistContainer = document.getElementById('checklistContainer');
            
            CHECKLIST_ITEMS.forEach((item, index) => {
                const checked = checklist.includes(index);
                const html = `
                    <div class="checklist-item ${checked ? 'checked' : ''}" data-index="${index}">
                        <div class="checklist-checkbox"></div>
                        <span class="checklist-label">${item}</span>
                    </div>
                `;
                checklistContainer.insertAdjacentHTML('beforeend', html);
            });
            
            checklistContainer.addEventListener('click', (e) => {
                const item = e.target.closest('.checklist-item');
                if (!item) return;
                
                const index = parseInt(item.dataset.index);
                const checklistIndex = checklist.indexOf(index);
                
                if (checklistIndex > -1) {
                    checklist.splice(checklistIndex, 1);
                    item.classList.remove('checked');
                } else {
                    checklist.push(index);
                    item.classList.add('checked');
                }
                
                localStorage.setItem('checklist', JSON.stringify(checklist));
            });
        }
        
        // ============================================
        // PWA
        // ============================================
        
        function initInstallPrompt() {
            const installPrompt = document.getElementById('installPrompt');
            const installBtn = document.getElementById('installBtn');
            const installClose = document.getElementById('installClose');
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installPrompt.classList.add('active');
            });
            
            installBtn.addEventListener('click', async () => {
                if (!deferredPrompt) return;
                
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    installPrompt.classList.remove('active');
                }
                
                deferredPrompt = null;
            });
            
            installClose.addEventListener('click', () => {
                installPrompt.classList.remove('active');
            });
        }
        
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.error('Service Worker error:', err));
            }
        }
    </script>
</body>
</html>